#!/bin/sh

# ANSI Color Codes
GREEN="\033[1;32m"
CYAN="\033[1;36m"
YELLOW="\033[1;33m"
RED="\033[1;31m"
MAGENTA="\033[1;35m"
NC="\033[0m" # No Color

# Animasi loading
spinner() {
  local pid=$!
  local delay=0.1
  local spinstr='|/-\'
  echo -n " "
  while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
    local temp=${spinstr#?}
    printf " [%c]  " "$spinstr"
    local spinstr=$temp${spinstr%"$temp"}
    sleep $delay
    printf "\b\b\b\b\b\b"
  done
  echo " âœ…"
}

echo -e "${CYAN}ğŸš€ Running pre-commit hook...${NC}"

# ğŸ” Running Tests
echo -e "${YELLOW}ğŸ”¬ Running tests...${NC}"
(yarn test --passWithNoTests > /dev/null 2>&1) & spinner
if [ $? -ne 0 ]; then
  echo -e "${RED}âŒ Tests failed! Commit aborted.${NC} ğŸ’¥"
  exit 1
fi

# ğŸ¨ Format Check
echo -e "${MAGENTA}ğŸ¨ Checking code format...${NC}"
(npm run check-format > /dev/null 2>&1) & spinner
if [ $? -ne 0 ]; then
  echo -e "${RED}âŒ Format check failed! Please run 'npm run format'.${NC} âœ¨"
  exit 1
fi

# ğŸš¨ Lint Check
echo -e "${YELLOW}ğŸš¨ Running lint check...${NC}"
(npm run check-lint > /dev/null 2>&1) & spinner
if [ $? -ne 0 ]; then
  echo -e "${RED}âŒ Lint check failed! Please fix lint errors.${NC} ğŸš«"
  exit 1
fi

# ğŸ—ï¸ Type Checking
echo -e "${CYAN}ğŸ§  Running type check...${NC}"
(npm run check-types > /dev/null 2>&1) & spinner
if [ $? -ne 0 ]; then
  echo -e "${RED}âŒ Type check failed! Please fix TypeScript errors.${NC} ğŸ”"
  exit 1
fi

# âœ… All Checks Passed
echo -e "${GREEN}ğŸ‰ All checks passed! Great job, you're amazing! ğŸš€âœ¨${NC}"
echo -e "${MAGENTA}ğŸ’¡ Remember: Clean code is happy code! ğŸ˜ƒ${NC}"

exit 0
